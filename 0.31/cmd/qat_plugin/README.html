<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Intel QuickAssist Technology (QAT) device plugin for Kubernetes &mdash; Intel® Device Plugins for Kubernetes  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css" />

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Intel Software Guard Extensions (SGX) device plugin for Kubernetes" href="../sgx_plugin/README.html" />
    <link rel="prev" title="Intel Device Plugins Operator" href="../operator/README.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            Intel® Device Plugins for Kubernetes
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../README.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../DEVEL.html">Instructions for Device Plugin Development and Maintenance</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../docs/extensions.html">Extensions</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../dlb_plugin/README.html">Intel DLB device plugin for Kubernetes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dsa_plugin/README.html">Intel DSA device plugin for Kubernetes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../fpga_admissionwebhook/README.html">Intel FPGA admission controller for Kubernetes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../fpga_crihook/README.html">Intel FPGA OCI createRuntime hook for Kubernetes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../fpga_plugin/README.html">Intel FPGA device plugin for Kubernetes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../fpga_tool/README.html">Intel FPGA test tool</a></li>
<li class="toctree-l2"><a class="reference internal" href="../gpu_nfdhook/README.html">Intel GPU NFD hook</a></li>
<li class="toctree-l2"><a class="reference internal" href="../gpu_plugin/README.html">Intel GPU device plugin for Kubernetes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iaa_plugin/README.html">Intel IAA device plugin for Kubernetes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../operator/README.html">Intel Device Plugins Operator</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Intel QuickAssist Technology (QAT) device plugin for Kubernetes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="#modes-and-configuration-options">Modes and Configuration Options</a></li>
<li class="toctree-l3"><a class="reference internal" href="#installation">Installation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#prerequisites">Prerequisites</a></li>
<li class="toctree-l4"><a class="reference internal" href="#pre-built-images">Pre-built Images</a></li>
<li class="toctree-l4"><a class="reference internal" href="#automatic-provisioning">Automatic Provisioning</a></li>
<li class="toctree-l4"><a class="reference internal" href="#verify-plugin-registration">Verify Plugin Registration</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#demos-and-testing">Demos and Testing</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#dpdk-qat-demos">DPDK QAT demos</a></li>
<li class="toctree-l4"><a class="reference internal" href="#openssl-qat-demo">OpenSSL QAT Demo</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#checking-for-hardware">Checking for Hardware</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../sgx_plugin/README.html">Intel Software Guard Extensions (SGX) device plugin for Kubernetes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sgx_admissionwebhook/README.html">Intel SGX admission controller for Kubernetes</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../demo/readme.html">Demo</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/intel/intel-device-plugins-for-kubernetes">Project GitHub repository</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Intel® Device Plugins for Kubernetes</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../docs/extensions.html">Extensions</a></li>
      <li class="breadcrumb-item active">Intel QuickAssist Technology (QAT) device plugin for Kubernetes</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/cmd/qat_plugin/README.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="intel-quickassist-technology-qat-device-plugin-for-kubernetes">
<h1>Intel QuickAssist Technology (QAT) device plugin for Kubernetes<a class="headerlink" href="#intel-quickassist-technology-qat-device-plugin-for-kubernetes" title="Permalink to this heading"></a></h1>
<p>Table of Contents</p>
<ul class="simple">
<li><p><a class="reference external" href="#introduction">Introduction</a></p></li>
<li><p><a class="reference external" href="#modes-and-configuration-options">Modes and Configuration Options</a></p></li>
<li><p><a class="reference external" href="#installation">Installation</a></p>
<ul>
<li><p><a class="reference external" href="#prerequisites">Prerequisites</a></p></li>
<li><p><a class="reference external" href="#pre-built-images">Pre-built Images</a></p></li>
<li><p><a class="reference external" href="#automatic-provisioning">Automatic Provisioning</a></p></li>
<li><p><a class="reference external" href="#verify-plugin-registration">Verify Plugin Registration</a></p></li>
</ul>
</li>
<li><p><a class="reference external" href="#demos-and-testing">Demos and Testing</a></p>
<ul>
<li><p><a class="reference external" href="#dpdk-qat-demos">DPDK QAT Demos</a></p>
<ul>
<li><p><a class="reference external" href="#dpdk-prerequisites">DPDK Prerequisites</a></p></li>
<li><p><a class="reference external" href="#deploy-the-pod">Deploy the pod</a></p></li>
</ul>
</li>
<li><p><a class="reference external" href="#openssl-qat-demo">OpenSSL QAT Demo</a></p></li>
</ul>
</li>
<li><p><a class="reference external" href="#checking-for-hardware">Checking for Hardware</a></p></li>
</ul>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this heading"></a></h2>
<p>This Intel QAT device plugin provides support for Intel QAT devices under Kubernetes.
The supported devices are determined by the VF device drivers available in your Linux
Kernel. See the <a class="reference external" href="#prerequisites">Prerequisites</a> section for more details.</p>
<p>Supported Devices include, but may not be limited to, the following:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://www-ssl.intel.com/content/www/us/en/design/products-and-solutions/processors-and-chipsets/purley/intel-xeon-scalable-processors.html">Intel® Xeon® with Intel® C62X Series Chipset</a></p></li>
<li><p>Intel® Xeon® with Intel® QAT Gen4 devices</p></li>
<li><p><a class="reference external" href="https://www.intel.com/content/www/us/en/design/products-and-solutions/processors-and-chipsets/denverton/ns/atom-processor-c3000-series.html">Intel® Atom™ Processor C3000</a></p></li>
<li><p><a class="reference external" href="https://www.intel.com/content/www/us/en/ethernet-products/gigabit-server-adapters/quickassist-adapter-8950-brief.html">Intel® Communications Chipset 8925 to 8955 Series</a></p></li>
</ul>
<p>The QAT device plugin provides access to QAT hardware accelerated cryptographic and compression features
through the SR-IOV virtual functions (VF). Demonstrations are provided utilising <a class="reference external" href="https://doc.dpdk.org/">DPDK</a> and <a class="reference external" href="https://www.openssl.org/">OpenSSL</a>.</p>
<p>QAT Kubernetes resources show up as <code class="docutils literal notranslate"><span class="pre">qat.intel.com/generic</span></code> on systems <em>before</em> QAT Gen4 (4th Gen Xeon®) and <code class="docutils literal notranslate"><span class="pre">qat.intel.com/[cy|dc]</span></code> on QAT Gen4.</p>
</section>
<section id="modes-and-configuration-options">
<h2>Modes and Configuration Options<a class="headerlink" href="#modes-and-configuration-options" title="Permalink to this heading"></a></h2>
<p>The QAT plugin can take a number of command line arguments, summarised in the following table:</p>
<table border="1" class="docutils">
<thead>
<tr>
<th style="text-align: left;">Flag</th>
<th style="text-align: left;">Argument</th>
<th style="text-align: left;">Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">-dpdk-driver</td>
<td style="text-align: left;">string</td>
<td style="text-align: left;">DPDK Device driver for configuring the QAT device (default: <code>vfio-pci</code>)</td>
</tr>
<tr>
<td style="text-align: left;">-kernel-vf-drivers</td>
<td style="text-align: left;">string</td>
<td style="text-align: left;">Comma separated list of the QuickAssist VFs to search and use in the system. Devices supported: DH895xCC, C62x, C3xxx, 4xxx/401xx/402xx, 420xx, C4xxx and D15xx (default: <code>4xxxvf,420xxvf</code>)</td>
</tr>
<tr>
<td style="text-align: left;">-max-num-devices</td>
<td style="text-align: left;">int</td>
<td style="text-align: left;">maximum number of QAT devices to be provided to the QuickAssist device plugin (default: <code>64</code>)</td>
</tr>
<tr>
<td style="text-align: left;">-mode</td>
<td style="text-align: left;">string</td>
<td style="text-align: left;">Deprecated: plugin mode which can be either <code>dpdk</code> or <code>kernel</code> (default: <code>dpdk</code>).</td>
</tr>
<tr>
<td style="text-align: left;">-allocation-policy</td>
<td style="text-align: left;">string</td>
<td style="text-align: left;">2 possible values: balanced and packed. Balanced mode spreads allocated QAT VF resources balanced among QAT PF devices, and packed mode packs one QAT PF device full of QAT VF resources before allocating resources from the next QAT PF. (There is no default.)</td>
</tr>
</tbody>
</table><p>The plugin also accepts a number of other arguments related to logging. Please use the <code class="docutils literal notranslate"><span class="pre">-h</span></code> option to see
the complete list of logging related options.</p>
<p>For more details on the <code class="docutils literal notranslate"><span class="pre">-dpdk-driver</span></code> choice, see
<a class="reference external" href="http://dpdk.org/doc/guides/linux_gsg/linux_drivers.html">DPDK Linux Driver Guide</a>.</p>
<blockquote>
<div><p><strong>Note:</strong>: With Linux 5.9+ kernels the <code class="docutils literal notranslate"><span class="pre">vfio-pci</span></code> module must be loaded with
<code class="docutils literal notranslate"><span class="pre">disable_denylist=1</span></code> parameter for the QAT device plugin to work correctly with
devices prior to Gen4 (<code class="docutils literal notranslate"><span class="pre">4xxx</span></code>).</p>
</div></blockquote>
<p>For more details on the available options to the <code class="docutils literal notranslate"><span class="pre">-kernel-vf-drivers</span></code> option, see the list of
vf drivers available in the <a class="reference external" href="https://github.com/torvalds/linux/tree/master/drivers/crypto/intel/qat">Linux Kernel</a>.</p>
<p>If the <code class="docutils literal notranslate"><span class="pre">-mode</span></code> parameter is set to <code class="docutils literal notranslate"><span class="pre">kernel</span></code>, no other parameter documented above are valid,
except the <code class="docutils literal notranslate"><span class="pre">klog</span></code> logging related parameters.
<code class="docutils literal notranslate"><span class="pre">kernel</span></code> mode implements resource allocation based on system configured <a class="reference external" href="https://www.intel.com/content/www/us/en/content-details/710060/intel-quickassist-technology-software-for-linux-programmer-s-guide-hw-version-1-7.html">logical instances</a> and
it does not guarantee full device isolation between containers. Therefore, it’s not recommended.</p>
<blockquote>
<div><p><strong>Note</strong>: <code class="docutils literal notranslate"><span class="pre">-mode</span></code> parameter is deprecated and it is also not made available as an option to
the operator based deployment. Furthermore, <code class="docutils literal notranslate"><span class="pre">kernel</span></code> mode is excluded by default from all builds (including those hosted on the Docker hub),
by default. See the <a class="reference external" href="#build-the-plugin-image">Build the plugin image</a> section for more details.</p>
</div></blockquote>
</section>
<section id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Permalink to this heading"></a></h2>
<p>The below sections cover how to obtain, build and install this component.</p>
<p>The component can be installed either using a DaemonSet or running ‘by hand’ on each node.</p>
<section id="prerequisites">
<h3>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this heading"></a></h3>
<p>The component has the same basic dependencies as the
<a class="reference external" href="../../README.html#about">generic plugin framework dependencies</a>.</p>
<p>You will also need <a class="reference external" href="#checking-for-hardware">appropriate hardware installed</a>.</p>
<p>The QAT plugin requires Linux Kernel VF QAT drivers to be available. These drivers
are available via two methods. One of them must be installed and enabled:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/torvalds/linux/tree/master/drivers/crypto/intel/qat">Linux Kernel upstream drivers</a></p></li>
<li><p><a class="reference external" href="https://www.intel.com/content/www/us/en/content-details/710059/intel-quickassist-technology-software-for-linux-getting-started-guide-hw-version-1-7.html">Intel QuickAssist Technology software for Linux</a> (<strong>Note</strong>: not applicable to QAT Gen4)</p></li>
</ul>
<p>The demonstrations have their own requirements, listed in their own specific sections.</p>
</section>
<section id="pre-built-images">
<h3>Pre-built Images<a class="headerlink" href="#pre-built-images" title="Permalink to this heading"></a></h3>
<p><a class="reference external" href="https://hub.docker.com/r/intel/intel-qat-plugin">Pre-built images</a>
of this component are available on the Docker hub. These images are automatically built and uploaded
to the hub from the latest main branch of this repository.</p>
<p>Release tagged images of the components are also available on the Docker hub, tagged with their
release version numbers in the format <code class="docutils literal notranslate"><span class="pre">x.y.z</span></code>, corresponding to the branches and releases in this
repository. Thus the easiest way to deploy the plugin in your cluster is to run this command</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>kubectl<span class="w"> </span>apply<span class="w"> </span>-k<span class="w"> </span><span class="s1">&#39;https://github.com/intel/intel-device-plugins-for-kubernetes/deployments/qat_plugin?ref=&lt;RELEASE_VERSION&gt;&#39;</span>
</pre></div>
</div>
<p>Where <code class="docutils literal notranslate"><span class="pre">&lt;RELEASE_VERSION&gt;</span></code> needs to be substituted with the desired <a class="reference external" href="https://github.com/intel/intel-device-plugins-for-kubernetes/tags">release tag</a> or <code class="docutils literal notranslate"><span class="pre">main</span></code> to get <code class="docutils literal notranslate"><span class="pre">devel</span></code> images.</p>
<p>An alternative kustomization for deploying the plugin is with the debug mode switched on:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>kubectl<span class="w"> </span>apply<span class="w"> </span>-k<span class="w"> </span><span class="s1">&#39;https://github.com/intel/intel-device-plugins-for-kubernetes/deployments/qat_plugin/overlays/debug?ref=&lt;RELEASE_VERSION&gt;&#39;</span>
</pre></div>
</div>
<blockquote>
<div><p><strong>Note</strong>: It is also possible to run the QAT device plugin using a non-root user. To do this,
the nodes’ DAC rules must be configured to allow PCI driver unbinding/binding, device plugin
socket creation and kubelet registration. Furthermore, the deployments <code class="docutils literal notranslate"><span class="pre">securityContext</span></code> must
be configured with appropriate <code class="docutils literal notranslate"><span class="pre">runAsUser/runAsGroup</span></code>.</p>
</div></blockquote>
</section>
<section id="automatic-provisioning">
<h3>Automatic Provisioning<a class="headerlink" href="#automatic-provisioning" title="Permalink to this heading"></a></h3>
<p>There’s a sample <a class="reference external" href="https://github.com/intel/intel-device-plugins-for-kubernetes/blob/main/build/docker/intel-qat-initcontainer.Dockerfile">qat initcontainer</a>. Regardless of device types, the script running inside the initcontainer enables QAT SR-IOV VFs.</p>
<p>To deploy, run as follows:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>kubectl<span class="w"> </span>apply<span class="w"> </span>-k<span class="w"> </span>deployments/qat_plugin/overlays/qat_initcontainer/
</pre></div>
</div>
<p>In addition to the default configuration, you can add device-specific configurations via ConfigMap.</p>
<table border="1" class="docutils">
<thead>
<tr>
<th style="text-align: left;">Device</th>
<th style="text-align: left;">Possible Configuration</th>
<th style="text-align: left;">How To Customize</th>
<th style="text-align: left;">Options</th>
<th style="text-align: left;">Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">4xxx, 401xx, 402xx, 420xx</td>
<td style="text-align: left;"><a href="https://github.com/torvalds/linux/blob/v6.6-rc5/Documentation/ABI/testing/sysfs-driver-qat">cfg_services</a> reports the configured services (crypto services or compression services) of the QAT device.</td>
<td style="text-align: left;"><code>ServicesEnabled=&lt;value&gt;</code></td>
<td style="text-align: left;">compress:<code>dc</code>, crypto:<code>sym;asym</code>, <br>crypto+compress:<code>asym;dc</code>,<br>crypto+compress:<code>sym;dc</code></td>
<td style="text-align: left;">4xxx/401xx/402xx: Linux 6.0+ kernel. 420xx: Linux 6.8+ kernel.</td>
</tr>
</tbody>
</table><p>To create a provisioning <code class="docutils literal notranslate"><span class="pre">configMap</span></code>, run the following command before deploying initcontainer:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>kubectl<span class="w"> </span>create<span class="w"> </span>configmap<span class="w"> </span>--namespace<span class="o">=</span>inteldeviceplugins-system<span class="w"> </span>qat-config<span class="w"> </span>--from-file<span class="o">=</span>/path/to/qat.conf
</pre></div>
</div>
<p>or</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>kubectl<span class="w"> </span>create<span class="w"> </span>configmap<span class="w"> </span>--namespace<span class="o">=</span>inteldeviceplugins-system<span class="w"> </span>--from-literal<span class="w"> </span><span class="s2">&quot;qat.conf=ServicesEnabled=&lt;option&gt;&quot;</span><span class="w"> </span>qat-config
</pre></div>
</div>
<p>When using the operator for deploying the plugin with provisioning config, use <code class="docutils literal notranslate"><span class="pre">provisioningConfig</span></code> field for the name of the ConfigMap, then the config is passed to initcontainer through the volume mount.</p>
<p>There’s also a possibility for a node specific congfiguration through passing a nodename via <code class="docutils literal notranslate"><span class="pre">NODE_NAME</span></code> into initcontainer’s environment and passing a node specific profile (<code class="docutils literal notranslate"><span class="pre">qat-$NODE_NAME.conf</span></code>) via ConfigMap volume mount.</p>
<p>Existing DaemonSet annotations can be updated through CR annotations in <a class="reference external" href="https://github.com/intel/intel-device-plugins-for-kubernetes/blob/cdeaf64855a29a2467f3ae97fe71593a480d23a1/cmd/qat_plugin/../../deployments/operator/samples/deviceplugin_v1_qatdeviceplugin.yaml">deviceplugin_v1_qatdeviceplugin.yaml</a>.</p>
<p>By default, the operator based deployment sets AppArmor policy to <code class="docutils literal notranslate"><span class="pre">&quot;unconfined&quot;</span></code> but this can be overridden by setting the AppArmor annotation to a new value in the CR annotations.</p>
<p>For non-operator plugin deployments such annotations can be dropped with the kustomization if required.</p>
</section>
<section id="verify-plugin-registration">
<h3>Verify Plugin Registration<a class="headerlink" href="#verify-plugin-registration" title="Permalink to this heading"></a></h3>
<p>Verification of the plugin deployment and detection of QAT hardware can be confirmed by
examining the resource allocations on the nodes:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>kubectl<span class="w"> </span>describe<span class="w"> </span>node<span class="w"> </span>&lt;node<span class="w"> </span>name&gt;<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>qat.intel.com/generic
<span class="w"> </span>qat.intel.com/generic:<span class="w"> </span><span class="m">10</span>
<span class="w"> </span>qat.intel.com/generic:<span class="w"> </span><span class="m">10</span>
</pre></div>
</div>
</section>
</section>
<section id="demos-and-testing">
<h2>Demos and Testing<a class="headerlink" href="#demos-and-testing" title="Permalink to this heading"></a></h2>
<p>The below sections cover <code class="docutils literal notranslate"><span class="pre">DPDK</span></code> and <code class="docutils literal notranslate"><span class="pre">OpenSSL</span></code> demos, both of which utilise the
QAT device plugin under Kubernetes.</p>
<section id="dpdk-qat-demos">
<h3>DPDK QAT demos<a class="headerlink" href="#dpdk-qat-demos" title="Permalink to this heading"></a></h3>
<p>The Data Plane Development Kit (DPDK) QAT demos use DPDK
<a class="reference external" href="https://doc.dpdk.org/guides/tools/cryptoperf.html">crypto-perf</a> and
<a class="reference external" href="https://doc.dpdk.org/guides/tools/comp_perf.html">compress-perf</a> utilities to exercise
DPDK QAT Poll-Mode Drivers (PMD). For more information on the tools’ parameters, refer to the
website links.</p>
<section id="dpdk-prerequisites">
<h4>DPDK Prerequisites<a class="headerlink" href="#dpdk-prerequisites" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p>For the DPDK QAT demos to work, the DPDK drivers must be loaded and configured.
For more information, refer to:
<a class="reference external" href="https://doc.dpdk.org/guides/linux_gsg/index.html">DPDK Getting Started Guide for Linux</a> and
<a class="reference external" href="http://dpdk.org/doc/guides/linux_gsg/linux_drivers.html">DPDK Getting Started Guide, Linux Drivers section</a></p></li>
<li><p>You may need to add hugepage request and limit.</p></li>
<li><p>The cluster must enable <a class="reference external" href="https://kubernetes.io/docs/tasks/administer-cluster/cpu-management-policies/">Kubernetes CPU manager’s</a> <code class="docutils literal notranslate"><span class="pre">static</span></code> policy.</p></li>
</ul>
<blockquote>
<div><p><strong>Note</strong>: If the <code class="docutils literal notranslate"><span class="pre">igb_uio</span></code> VF driver is used with the QAT device plugin,
the workload be deployed with <code class="docutils literal notranslate"><span class="pre">SYS_ADMIN</span></code> capabilities added.</p>
</div></blockquote>
</section>
<section id="deploy-the-pod">
<h4>Deploy the pod<a class="headerlink" href="#deploy-the-pod" title="Permalink to this heading"></a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>kubectl<span class="w"> </span>apply<span class="w"> </span>-k<span class="w"> </span>https://github.com/intel/intel-device-plugins-for-kubernetes/deployments/qat_dpdk_app/
$<span class="w"> </span>kubectl<span class="w"> </span>get<span class="w"> </span>pods
<span class="w">  </span>NAME<span class="w">                          </span>READY<span class="w">     </span>STATUS<span class="w">    </span>RESTARTS<span class="w">   </span>AGE
<span class="w">  </span>qat-dpdk-test-crypto-perf<span class="w">     </span><span class="m">1</span>/1<span class="w">       </span>Running<span class="w">   </span><span class="m">0</span><span class="w">          </span>27m
<span class="w">  </span>qat-dpdk-test-compress-perf<span class="w">   </span><span class="m">1</span>/1<span class="w">       </span>Running<span class="w">   </span><span class="m">0</span><span class="w">          </span>27m
<span class="w">  </span>intel-qat-plugin-5zgvb<span class="w">        </span><span class="m">1</span>/1<span class="w">       </span>Running<span class="w">   </span><span class="m">0</span><span class="w">          </span>3h
</pre></div>
</div>
<p>Both pods for <a class="reference external" href="https://github.com/intel/intel-device-plugins-for-kubernetes/tree/cdeaf64855a29a2467f3ae97fe71593a480d23a1/cmd/qat_plugin/../..//deployments/qat_dpdk_app/crypto-perf">crypto-perf</a> and <a class="reference external" href="https://github.com/intel/intel-device-plugins-for-kubernetes/tree/cdeaf64855a29a2467f3ae97fe71593a480d23a1/cmd/qat_plugin/../../deployments/qat_dpdk_app/compress-perf">compress-perf</a> are generated by default using <code class="docutils literal notranslate"><span class="pre">kustomize</span></code>.</p>
<p>It is also possible to deploy and run <code class="docutils literal notranslate"><span class="pre">crypto-perf</span></code> or <code class="docutils literal notranslate"><span class="pre">compress-perf</span></code> only.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>kubectl<span class="w"> </span>apply<span class="w"> </span>-k<span class="w"> </span>https://github.com/intel/intel-device-plugins-for-kubernetes/deployments/qat_dpdk_app/crypto-perf
$<span class="w"> </span>kubectl<span class="w"> </span>logs<span class="w"> </span>qat-dpdk-test-crypto-perf
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>kubectl<span class="w"> </span>apply<span class="w"> </span>-k<span class="w"> </span>https://github.com/intel/intel-device-plugins-for-kubernetes/deployments/qat_dpdk_app/compress-perf
$<span class="w"> </span>kubectl<span class="w"> </span>logs<span class="w"> </span>qat-dpdk-test-compress-perf
</pre></div>
</div>
</section>
</section>
<section id="openssl-qat-demo">
<h3>OpenSSL QAT Demo<a class="headerlink" href="#openssl-qat-demo" title="Permalink to this heading"></a></h3>
<p>Please refer to the <a class="reference external" href="https://github.com/kata-containers/documentation/blob/master/use-cases/using-Intel-QAT-and-kata.md#build-openssl-intel-qat-engine-container">Kata Containers documentation</a> for details on the OpenSSL
QAT acceleration demo.</p>
</section>
</section>
<section id="checking-for-hardware">
<h2>Checking for Hardware<a class="headerlink" href="#checking-for-hardware" title="Permalink to this heading"></a></h2>
<p>In order to utilise the QAT device plugin, QuickAssist SR-IOV virtual functions must be configured.
You can verify this on your nodes by checking for the relevant PCI identifiers:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="k">for</span><span class="w"> </span>i<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">0442</span><span class="w"> </span><span class="m">0443</span><span class="w"> </span>18a1<span class="w"> </span>37c9<span class="w"> </span>6f55<span class="w"> </span>19e3<span class="w"> </span><span class="m">4941</span><span class="w"> </span><span class="m">4943</span><span class="w"> </span><span class="m">4945</span><span class="w"> </span><span class="m">4947</span><span class="p">;</span><span class="w"> </span><span class="k">do</span><span class="w"> </span>lspci<span class="w"> </span>-d<span class="w"> </span><span class="m">8086</span>:<span class="nv">$i</span><span class="p">;</span><span class="w"> </span><span class="k">done</span>
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../operator/README.html" class="btn btn-neutral float-left" title="Intel Device Plugins Operator" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../sgx_plugin/README.html" class="btn btn-neutral float-right" title="Intel Software Guard Extensions (SGX) device plugin for Kubernetes" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020, various.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>