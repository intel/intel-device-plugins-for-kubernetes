<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Intel GPU NFD hook &mdash; Intel® Device Plugins for Kubernetes  documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> Intel® Device Plugins for Kubernetes
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../README.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../DEVEL.html">Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../docs/extensions.html">Extensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../demo/readme.html">Demo</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/intel/intel-device-plugins-for-kubernetes">Project GitHub repository</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Intel® Device Plugins for Kubernetes</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Intel GPU NFD hook</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/cmd/gpu_nfdhook/README.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="intel-gpu-nfd-hook">
<h1>Intel GPU NFD hook<a class="headerlink" href="#intel-gpu-nfd-hook" title="Permalink to this heading"></a></h1>
<p>This is the <a class="reference external" href="https://github.com/kubernetes-sigs/node-feature-discovery">Node Feature Discovery</a>
binary hook implementation for the Intel GPUs. The intel-gpu-initcontainer which
is built among other images can be placed as part of the gpu-plugin deployment,
so that it copies this hook to the host system only in those hosts, in which also
gpu-plugin is deployed.</p>
<p>When NFD worker runs this hook, it will add a number of labels to the nodes,
which can be used for example to deploy services to nodes with specific GPU
types. Selected numeric labels can be turned into kubernetes extended resources
by the NFD, allowing for finer grained resource management for GPU-using PODs.</p>
<p>In the NFD deployment, the hook requires <code class="docutils literal notranslate"><span class="pre">/host-sys</span></code> -folder to have the host <code class="docutils literal notranslate"><span class="pre">/sys</span></code>-folder content mounted. Write access is not necessary.</p>
<section id="gpu-memory">
<h2>GPU memory<a class="headerlink" href="#gpu-memory" title="Permalink to this heading"></a></h2>
<p>GPU memory amount is read from sysfs gt/gt* files and turned into a label.
There are two supported environment variables named <code class="docutils literal notranslate"><span class="pre">GPU_MEMORY_OVERRIDE</span></code> and
<code class="docutils literal notranslate"><span class="pre">GPU_MEMORY_RESERVED</span></code>. Both are supposed to hold numeric byte amounts. For systems with
older kernel drivers or GPUs which do not support reading the GPU memory
amount, the <code class="docutils literal notranslate"><span class="pre">GPU_MEMORY_OVERRIDE</span></code> environment variable value is turned into a GPU
memory amount label instead of a read value. <code class="docutils literal notranslate"><span class="pre">GPU_MEMORY_RESERVED</span></code> value will be
scoped out from the GPU memory amount found from sysfs.</p>
</section>
<section id="default-labels">
<h2>Default labels<a class="headerlink" href="#default-labels" title="Permalink to this heading"></a></h2>
<p>Following labels are created by default. You may turn numeric labels into extended resources with NFD.</p>
<table border="1" class="docutils">
<thead>
<tr>
<th>name</th>
<th>type</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>gpu.intel.com/millicores</code></td>
<td>number</td>
<td>node GPU count * 1000. Can be used as a finer grained shared execution fraction.</td>
</tr>
<tr>
<td><code>gpu.intel.com/memory.max</code></td>
<td>number</td>
<td>sum of detected <a href="#GPU-memory">GPU memory amounts</a> in bytes OR environment variable value * GPU count</td>
</tr>
<tr>
<td><code>gpu.intel.com/cards</code></td>
<td>string</td>
<td>list of card names separated by '<code>.</code>'. The names match host <code>card*</code>-folders under <code>/sys/class/drm/</code>.</td>
</tr>
</tbody>
</table></section>
<section id="capability-labels-optional">
<h2>Capability labels (optional)<a class="headerlink" href="#capability-labels-optional" title="Permalink to this heading"></a></h2>
<p>Capability labels are created from information found inside debugfs, and therefore
unfortunately require running the NFD worker as root. Due to coming from debugfs,
which is not guaranteed to be stable, these are not guaranteed to be stable either.
If you don’t need these, simply do not run NFD worker as root, that is also more secure.
Depending on your kernel driver, running the NFD hook as root may introduce following labels:</p>
<table border="1" class="docutils">
<thead>
<tr>
<th>name</th>
<th>type</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>gpu.intel.com/platform_gen</code></td>
<td>string</td>
<td>GPU platform generation name, typically a number.</td>
</tr>
<tr>
<td><code>gpu.intel.com/platform_&lt;PLATFORM_NAME&gt;_.count</code></td>
<td>number</td>
<td>GPU count for the named platform.</td>
</tr>
<tr>
<td><code>gpu.intel.com/platform_&lt;PLATFORM_NAME&gt;_.tiles</code></td>
<td>number</td>
<td>GPU tile count in the GPUs of the named platform.</td>
</tr>
<tr>
<td><code>gpu.intel.com/platform_&lt;PLATFORM_NAME&gt;_.present</code></td>
<td>string</td>
<td>"true" for indicating the presense of the GPU platform.</td>
</tr>
</tbody>
</table><p>For the above to work as intended, installed GPUs must be identical in their capabilities.</p>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020, various.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>